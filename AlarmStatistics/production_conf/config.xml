<?xml version="1.0" encoding="UTF-8"?>
<configuration>
	<config desc="Redis缓存服务客户端配置">
		<property name="listenPort" desc="监听端口">8501</property>
		
		<property name="manualOperation" desc="手动统计-正常部署时为false">${manualOperation}</property>
		<property name="manualOperationDate" desc="手动统计日期-格式:yyyyMMdd">${manualOperationDate}</property>
		
		<property name="redisHost" desc="Redis服务器IP">${redisHost}</property>
		<property name="redisPort" desc="Redis服务器端口">${redisPort}</property>
		<property name="redisPass" desc="Redis密码">${redisPass}</property>
		<property name="redisMaxActive" desc="最大连接数">50</property>
		<property name="redisMaxIdle" desc="最大空闲连接数">10</property>
		<property name="redisMaxWait" desc="最大等待时间(毫秒)">10000</property>
		<property name="redisTimeOut" desc="连接超时时间">30000</property>
		
		<!-- Oracle缓存服务客户端配置 -->
		<property name="oracleUrl" desc="连接路径">${oracleUrl}</property>
		<property name="oracleUser" desc="用户名">${oracleUser}</property>
		<property name="oraclePass" desc="密码">${oraclePass}</property>
		<property name="oracleInitialSize" desc="初始化连接数">10</property>
		<property name="oracleMaxActive" desc="最大连接数">100</property>
		<property name="oracleMinIdle" desc="最小空闲连接数">10</property>
		<property name="oracleMaxWait" desc="最大等待">60000</property>
		<property name="oracleTimeBetweenEvictionRunsMillis" desc="隔多久才进行一次检测，检测需要关闭的空闲连接">60000</property>
		<property name="oracleMinEvictableIdleTimeMillis" desc="连接在池中最小生存的时间">300000</property>
		<property name="oracleTestWhileIdle" desc="测试空闲连接">true</property>
		<property name="oracleTestOnBorrow" desc="从数据库连接池中取得连接时，对其的有效性进行检查">true</property>
		<property name="oracleTestOnReturn" desc="用完连接放回连接池时是否对有效性进行检查">false</property>
		<property name="oracleMaxPoolPreparedStatementPerConnectionSize" desc="打开PSCache，并且指定每个连接上PSCache的大小">10</property>
		

		<!-- 业务线程配置 -->
		<property name="trackPath" desc="路径">${trackPath}</property>
		<property name="trackReaderSize" desc="业务线程数量">8</property>
		<property name="statisticsStateInterval" desc="统计状态显示间隔-单位:毫秒">3000</property>
		<property name="alarmBatchTime" desc="告警批量提交间隔时间-单位:毫秒">5000</property>
		<property name="alarmBatchSize" desc="告警批量提交数量-单位:条">2000</property>
		<property name="alarmStorageLogTime" desc="日志输出时间间隔 -单位:毫秒">30000</property>
		<property name="rerun" desc="是否重跑">${rerun}</property>
		<property name="rerunStartDate" desc="重跑开始时间">${rerunStartDate}</property>
		<property name="rerunDays" desc="重跑天数">${rerunDays}</property>
		
		<!-- 统计数据删除SQL -->
		<property name="sql_deleteAlarmDetail" desc="删除告警明细SQL">DELETE KCPT.TH_TRACK_ALARM T WHERE T.START_UTC &gt;= ? AND T.START_UTC &lt;= ?</property>
		<property name="sql_deleteOverspeedStatisticsDay" desc="删除超速日统计">DELETE KCPT.TS_STATISTICS_OVERSPEED T WHERE T.STATISTIC_DATE &gt;= ? AND T.STATISTIC_DATE &lt;= ?</property>
		<property name="sql_deleteOverspeedStatisticsMonth" desc="删除超速月统计">DELETE FROM KCPT.TS_OVERSPEED_MONTH T WHERE T.STATISTIC_DATE &gt;= ? AND T.STATISTIC_DATE &lt;= ?</property>
		<property name="sql_deleteAlarmLevelStatisticsDay" desc="删除告警级别日统计">DELETE KCPT.TS_ALARM_LEVEL_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
        <property name="sql_deleteAlarmLevelStatisticsWeek" desc="删除告警级别周统计">DELETE FROM KCPT.TS_ALARM_LEVEL_WEEK T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
        <property name="sql_deleteAlarmLevelStatisticsMonth" desc="删除告警级别月统计">DELETE FROM KCPT.TS_ALARM_LEVEL_MONTH T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
        <property name="sql_deleteAlarmTypeStatisticsDay" desc="删除告警类型日统计">DELETE KCPT.TS_ALARM_TYPE_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
        <property name="sql_deleteAlarmTypeStatisticsMonth" desc="删除告警类型月统计">DELETE FROM KCPT.TS_ALARM_TYPE_MONTH T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
        <property name="sql_deleteDangerousDrivingStatisticsDay" desc="删除危险驾驶日统计">DELETE KCPT.TS_DANGEROUS_DRIVING_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
 		<property name="sql_deleteDangerousDrivingStatisticsMonth" desc="删除危险驾驶月统计">DELETE FROM KCPT.TS_DANGEROUS_DRIVING_MONTH T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
 		<property name="sql_deleteDangerousDrivingStatisticsDriverDay" desc="删除驾驶员危险驾驶日统计">DELETE KCPT.TS_DANGEROUS_DRIVER_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
 		<property name="sql_deleteDangerousDrivingStatisticsDriverMonth" desc="删除驾驶员危险驾驶月统计">DELETE FROM KCPT.TS_DANGEROUS_DRIVER_MONTH T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
 		<property name="sql_deleteViolationStatisticsDay" desc="删除违规日统计">DELETE KCPT.TS_VIOLATION_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
		<property name="sql_deleteViolationStatisticsMonth" desc="删除违规日统计">DELETE FROM KCPT.TS_VIOLATION_MONTH T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
		<property name="sql_deleteViolationStatisticsDriverDay" desc="删除驾驶员违规日统计">DELETE KCPT.TS_VIOLATION_DRIVER_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
		<property name="sql_deleteViolationStatisticsDriverMonth" desc="删除驾驶员违规日统计">DELETE FROM KCPT.TS_VIOLATION_DRIVER_MONTH T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
		
		<!-- 统计数据导入SQL -->
		<property name="sql_importOilAlarm" desc="导入偷漏油告警">INSERT INTO KCPT.TH_TRACK_ALARM TA SELECT T.ALARM_ID, T.VID, T.VEHICLE_NO, T.TEAM_ID, T.TEAM_NAME, T.CORP_ID, T.CORP_NAME, T.ALARM_CODE, T.ALARM_SRC, 'A005', T.ALARM_END_UTC - T.ALARM_START_UTC AS DURATION, T.MAX_SPEED, T.AVG_SPEED, 950, T.ALARM_START_UTC, T.MAPLON, T.MAPLAT, T.ALARM_END_UTC, T.END_MAPLON, T.END_MAPLAT, T.ALARM_START_UTC, DECODE(SIGN(T.END_MILEAGE - T.MILEAGE),-1,0,T.END_MILEAGE - T.MILEAGE,0) AS ALARM_MILEAGE, 3 AS ALARM_LEVEL,T.DRIVER_ID,T.DRIVER_SRC,T.GPS_SPEED,T.END_GPS_SPEED FROM KCPT.TH_VEHICLE_ALARM T WHERE T.ALARM_CODE = '111'  AND T.UTC &gt;= ? AND T.UTC &lt;= ?</property>
		<property name="sql_importOfflineAlarm" desc="导入离线出线路告警">INSERT INTO KCPT.TH_TRACK_ALARM TA SELECT T.AUTO_ID, T.VID, T.VEHICLENO, T.TEAM_ID, T.TEAM_NAME, T.CORP_ID, T.CORP_NAME, T.ALARM_CODE, T.ALARM_SRC, 'A005', T.ALARM_EVENT_TIME * 1000 AS DURATION, T.AVG_SPEED, T.AVG_SPEED, T.SPEED_THRESHOLD AS SPEED_THRESHOLD, T.BEGIN_UTC, T.BEGIN_MAPLON, T.BEGIN_MAPLAT, T.END_UTC, T.END_MAPLON, T.END_MAPLAT, T.BEGIN_UTC, 0 AS ALARM_MILEAGE, 4 AS ALARM_LEVEL,T.DRIVER_ID,T.DRIVER_SRC,T.BEGIN_GPS_SPEED,T.END_GPS_SPEED FROM KCPT.TH_VEHICLE_ALARM_EVENT T WHERE (T.ALARM_CODE = '66' OR T.ALARM_CODE = '69')  AND T.BEGIN_UTC &gt;= ? AND T.BEGIN_UTC &lt;= ?</property>
		<property name="sql_importAreaAlarm" desc="导入围栏告警">INSERT INTO KCPT.TH_TRACK_ALARM SELECT T.AUTO_ID,T.VID,T.VEHICLENO,T.TEAM_ID,T.TEAM_NAME,T.CORP_ID,T.CORP_NAME,T.ALARM_CODE,T.ALARM_SRC,'A002',T.ALARM_EVENT_TIME * 1000 AS DURATION,T.AVG_SPEED,T.AVG_SPEED,T.SPEED_THRESHOLD AS SPEED_THRESHOLD,T.BEGIN_UTC,T.BEGIN_MAPLON,T.BEGIN_MAPLAT,T.END_UTC,T.END_MAPLON,T.END_MAPLAT,T.BEGIN_UTC,0 AS ALARM_MILEAGE,3 AS ALARM_LEVEL,T.DRIVER_ID,T.DRIVER_SRC,T.BEGIN_GPS_SPEED,T.END_GPS_SPEED FROM KCPT.TH_VEHICLE_ALARM_EVENT T WHERE (T.ALARM_CODE = '60' OR T.ALARM_CODE = '61' OR T.ALARM_CODE = '62' OR T.ALARM_CODE = '63' OR T.ALARM_CODE = '64' OR T.ALARM_CODE = '65' OR T.ALARM_CODE = '67' OR T.ALARM_CODE = '68' OR T.ALARM_CODE = '6220') AND T.ALARM_SRC != 1 AND T.BEGIN_UTC &gt;= ? AND T.BEGIN_UTC &lt;= ?</property>
		<property name="sql_importOverspeedAlarm" desc="导入超速告警">INSERT INTO KCPT.TH_TRACK_ALARM TA SELECT T.AUTO_ID,T.VID,T.VEHICLENO,T.TEAM_ID,T.TEAM_NAME,T.CORP_ID,T.CORP_NAME,T.ALARM_CODE,T.ALARM_SRC,'A001',T.ALARM_EVENT_TIME * 1000 AS DURATION,T.AVG_SPEED,T.AVG_SPEED,T.SPEED_THRESHOLD AS SPEED_THRESHOLD,T.BEGIN_UTC,T.BEGIN_MAPLON,T.BEGIN_MAPLAT,T.END_UTC,T.END_MAPLON,T.END_MAPLAT,T.BEGIN_UTC,0 AS ALARM_MILEAGE,1 AS ALARM_LEVEL,T.DRIVER_ID,T.DRIVER_SRC,T.BEGIN_GPS_SPEED,T.END_GPS_SPEED FROM kcpt.th_vehicle_alarm_event t WHERE  T.ALARM_SRC != 1 AND t.alarm_code='1' AND t.begin_utc &gt;= ? AND t.begin_utc &lt;= ?</property>


		<!-- 统计SQL -->
		<property name="sql_saveAlarmList" desc="告警存储线程">INSERT INTO TH_TRACK_ALARM(ID,VID,PLATE,TEAM_ID,TEAM_NAME,ENT_ID,ENT_NAME,CODE,SOURCE,PARENT_TYPE,DURATION,MAX_SPEED,AVG_SPEED,SPEED_THRESHOLD,ALARM_MILEAGE,START_UTC,START_LON,START_LAT,END_UTC,END_LON,END_LAT,SYS_UTC,ALARM_LEVEL,DRIVER_ID,DRIVER_SOURCE,START_SPEED,END_SPEED) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)</property>
		<property name="sql_initAlarmParentCode" desc="加载报警父级编码">SELECT T.ALARM_CODE AS CODE,T.PARENT_CODE FROM SYS_ALARM_TYPE T WHERE T.PARENT_CODE != '-1'</property>
		<property name="sql_initVehicleInfo" desc="加载车辆信息">SELECT TV.VID,TV.VEHICLE_NO AS PLATE,TV.ENT_ID AS TEAM_ID,TEAM.ENT_NAME AS TEAM_NAME,ENT.ENT_ID,ENT.ENT_NAME,TT.PARAM_VALUE SPEED_LIMIT FROM KCPT.TR_SERVICEUNIT TS JOIN KCPT.TB_VEHICLE TV ON TS.VID = TV.VID JOIN KCPT.TB_ORGANIZATION TEAM ON TV.ENT_ID = TEAM.ENT_ID JOIN KCPT.TB_ORGANIZATION ENT ON TEAM.PARENT_ID = ENT.ENT_ID LEFT JOIN (SELECT TTP.TID, TTP.PARAM_VALUE FROM KCPT.TB_TERMINAL_PARAM TTP WHERE TTP.PARAM_ID = '128') TT ON TT.TID = TS.TID WHERE TV.ENABLE_FLAG = '1'</property>
	    <property name="sql_statisticsOverspeedDay" desc="超速日统计">INSERT INTO TS_STATISTICS_OVERSPEED SELECT ? AS STATISTIC_DATE, T.VID,T.PLATE,T.TEAM_ID,T.TEAM_NAME,T.ENT_ID,T.ENT_NAME,COUNT(T.VID) AS ALARM_COUNT,SUM(T.DURATION) AS ALARM_DURATION,SUM(T.ALARM_MILEAGE) AS ALARM_MILEAGE,MAX(T.MAX_SPEED) MAX_SPEED  FROM KCPT.TH_TRACK_ALARM T WHERE T.CODE='1' AND T.START_UTC &gt;= ? AND T.START_UTC &lt;= ?  GROUP BY VID, PLATE, TEAM_ID, TEAM_NAME, ENT_ID, ENT_NAME</property>
		<property name="sql_statisticsOverspeedMonth" desc="超速月统计">INSERT INTO TS_OVERSPEED_MONTH SELECT ? AS STATISTIC_DATE, ? AS STATISTIC_YEAR, ? AS STATISTIC_MONTH, T.VID, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME, SUM(T.ALARM_COUNT), SUM(T.ALARM_DURATION), SUM(T.ALARM_MILEAGE), MAX(T.MAX_SPEED) FROM KCPT.TS_STATISTICS_OVERSPEED T WHERE T.STATISTIC_DATE &gt; = ? AND T.STATISTIC_DATE &lt; = ? GROUP BY VID, PLATE, TEAM_ID, TEAM_NAME, ENT_ID, ENT_NAME </property>
		
		<property name="sql_statisticsDangerousDrivingDay" desc="危险驾驶日统计">INSERT INTO KCPT.TS_DANGEROUS_DRIVING_DAY SELECT ? AS STATISTIC_DATE, A.VID, A.PLATE, A.TEAM_ID, A.TEAM_NAME, A.ENT_ID, A.ENT_NAME, A.OVERSPEED, A.OVERSPEED_LENGTH, A.RPM, A.RPM_LENGTH, A.UP, A.UP_LENGTH, A.DOWN, A.DOWN_LENGTH, A.FATIGUE, A.FATIGUE_LENGTH, A.LDLING, A.LDLING_LENGTH, A.COLLIDE, A.COLLIDE_LENGTH, A.YAW, A.YAW_LENGTH FROM (SELECT T.VID, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME, SUM(CASE WHEN T.CODE = '1' THEN 1 ELSE 0 END) AS OVERSPEED, SUM(CASE WHEN T.CODE = '1' THEN T.DURATION ELSE 0 END) AS OVERSPEED_LENGTH, SUM(CASE WHEN T.CODE = '47' THEN 1 ELSE 0 END) AS RPM, SUM(CASE WHEN T.CODE = '47' THEN T.DURATION ELSE 0 END) AS RPM_LENGTH, SUM(CASE WHEN T.CODE = '48' THEN 1 ELSE 0 END) AS UP, SUM(CASE WHEN T.CODE = '48' THEN T.DURATION ELSE 0 END) AS UP_LENGTH, SUM(CASE WHEN T.CODE = '49' THEN 1 ELSE 0 END) AS DOWN, SUM(CASE WHEN T.CODE = '49' THEN T.DURATION ELSE 0 END) AS DOWN_LENGTH, SUM(CASE WHEN T.CODE = '2' THEN 1 ELSE 0 END) AS FATIGUE, SUM(CASE WHEN T.CODE = '2' THEN T.DURATION ELSE 0 END) AS FATIGUE_LENGTH, SUM(CASE WHEN T.CODE = '44' THEN 1 ELSE 0 END) AS LDLING, SUM(CASE WHEN T.CODE = '44' THEN T.DURATION ELSE 0 END) AS LDLING_LENGTH, SUM(CASE WHEN T.CODE = '55' THEN 1 ELSE 0 END) AS COLLIDE, SUM(CASE WHEN T.CODE = '55' THEN T.DURATION ELSE 0 END) AS COLLIDE_LENGTH, SUM(CASE WHEN T.CODE = '56' THEN 1 ELSE 0 END) AS YAW, SUM(CASE WHEN T.CODE = '56' THEN T.DURATION ELSE 0 END) AS YAW_LENGTH FROM KCPT.TH_TRACK_ALARM T WHERE T.START_UTC &gt;= ? AND T.START_UTC &lt;= ? GROUP BY T.VID, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME) A</property>
		<property name="sql_statisticsDangerousDrivingMonth" desc="危险驾驶月统计">INSERT INTO KCPT.TS_DANGEROUS_DRIVING_MONTH SELECT ? AS STATISTICS_DATE, ? AS STATISTICS_YEAR, ? AS STATISTICS_MONTH, A.VID, A.PLATE, A.TEAM_ID, A.TEAM_NAME, A.ENT_ID, A.ENT_NAME, SUM(A.OVERSPEED), SUM(A.OVERSPEED_LENGTH), SUM(A.RPM), SUM(A.RPM_LENGTH), SUM(A.ACCELERATGE), SUM(A.ACCELERATGE_LENGTH), SUM(A.DECELERATION), SUM(A.DECELERATION_LENGTH), SUM(A.FATIGUE), SUM(A.FATIGUE_LENGTH), SUM(A.GLIDE), SUM(A.GLIDE_LENGTH), SUM(A.COLLIDE), SUM(A.COLLIDE_LENGTH), SUM(A.YAW), SUM(A.YAW_LENGTH) FROM TS_DANGEROUS_DRIVING_DAY A WHERE A.STATISTICS_DATE &gt;= ? AND A.STATISTICS_DATE &lt;= ? GROUP BY A.VID, A.PLATE, A.TEAM_ID, A.TEAM_NAME, A.ENT_ID, A.ENT_NAME</property>
		<!-- TODO -->
		<property name="sql_statisticsDangerousDrivingDriverDay" desc="驾驶员危险驾驶日统计">INSERT INTO KCPT.TS_DANGEROUS_DRIVER_DAY SELECT ? AS STATISTIC_DATE,A.VID,A.DRIVER_ID,E.STAFF_NAME,E.DRIVER_ICCARD,A.PLATE,A.TEAM_ID,A.TEAM_NAME,A.ENT_ID,A.ENT_NAME,A.OVERSPEED,A.OVERSPEED_LENGTH,A.RPM,A.RPM_LENGTH,A.UP,A.UP_LENGTH,A.DOWN,A.DOWN_LENGTH,A.FATIGUE,A.FATIGUE_LENGTH,A.LDLING,A.LDLING_LENGTH,A.COLLIDE,A.COLLIDE_LENGTH,A.YAW,A.YAW_LENGTH FROM (SELECT T.VID,T.DRIVER_ID,T.PLATE,T.TEAM_ID,T.TEAM_NAME,T.ENT_ID,T.ENT_NAME, SUM(CASE WHEN T.CODE='1' THEN 1 ELSE 0 END) AS OVERSPEED,SUM(CASE WHEN T.CODE='1' THEN T.DURATION ELSE 0 END) AS OVERSPEED_LENGTH,SUM(CASE WHEN T.CODE='47' THEN 1 ELSE 0 END) AS RPM,SUM(CASE WHEN T.CODE='47' THEN T.DURATION ELSE 0 END) AS RPM_LENGTH,SUM(CASE WHEN T.CODE='48' THEN 1 ELSE 0 END) AS UP,SUM(CASE WHEN T.CODE='48' THEN T.DURATION ELSE 0 END) AS UP_LENGTH,SUM(CASE WHEN T.CODE='49' THEN 1 ELSE 0 END) AS DOWN,SUM(CASE WHEN T.CODE='49' THEN T.DURATION ELSE 0 END) AS DOWN_LENGTH,SUM(CASE WHEN T.CODE='2' THEN 1 ELSE 0 END) AS FATIGUE,SUM(CASE WHEN T.CODE='2' THEN T.DURATION ELSE 0 END) AS FATIGUE_LENGTH,SUM(CASE WHEN T.CODE='44' THEN 1 ELSE 0 END) AS LDLING,SUM(CASE WHEN T.CODE='44' THEN T.DURATION ELSE 0 END) AS LDLING_LENGTH,SUM(CASE WHEN T.CODE='55' THEN 1 ELSE 0 END) AS COLLIDE,SUM(CASE WHEN T.CODE='55' THEN T.DURATION ELSE 0 END) AS COLLIDE_LENGTH,SUM(CASE WHEN T.CODE='56' THEN 1 ELSE 0 END) AS YAW,SUM(CASE WHEN T.CODE='56' THEN T.DURATION ELSE 0 END) AS YAW_LENGTH FROM KCPT.TH_TRACK_ALARM T WHERE T.DRIVER_ID IS NOT NULL AND T.START_UTC &gt;= ? AND T.START_UTC &lt;= ? GROUP BY T.VID,T.DRIVER_ID,T.PLATE,T.TEAM_ID,T.TEAM_NAME,T.ENT_ID,T.ENT_NAME) A LEFT JOIN KCPT.TB_EMPLOYEE E ON A.DRIVER_ID = E.STAFF_ID</property>
		<property name="sql_statisticsDangerousDrivingDriverMonth" desc="驾驶员危险驾驶月统计">INSERT INTO KCPT.TS_DANGEROUS_DRIVER_MONTH SELECT ? AS STATISTICS_DATE, ? AS STATISTICS_YEAR, ? AS STATISTICS_MONTH, A.VID, A.DRIVER_ID, A.DRIVER_NAME, A.DRIVER_IC, A.PLATE, A.TEAM_ID, A.TEAM_NAME, A.ENT_ID, A.ENT_NAME, SUM(A.OVERSPEED), SUM(A.OVERSPEED_LENGTH), SUM(A.RPM), SUM(A.RPM_LENGTH), SUM(A.ACCELERATGE), SUM(A.ACCELERATGE_LENGTH), SUM(A.DECELERATION), SUM(A.DECELERATION_LENGTH), SUM(A.FATIGUE), SUM(A.FATIGUE_LENGTH), SUM(A.GLIDE), SUM(A.GLIDE_LENGTH), SUM(A.COLLIDE), SUM(A.COLLIDE_LENGTH), SUM(A.YAW), SUM(A.YAW_LENGTH) FROM TS_DANGEROUS_DRIVER_DAY A WHERE A.STATISTICS_DATE &gt;= ? AND A.STATISTICS_DATE &lt;= ? GROUP BY A.VID,A.DRIVER_ID,A.DRIVER_NAME,A.DRIVER_IC,A.PLATE,A.TEAM_ID,A.TEAM_NAME,A.ENT_ID,A.ENT_NAME</property>
		
		<property name="sql_statisticsOperationsViolationDay" desc="运营违规日统计">INSERT INTO TS_VIOLATION_DAY SELECT ? AS STATISTIC_DATE, VID, PLATE, TEAM_ID, TEAM_NAME, ENT_ID, ENT_NAME, OVERSPEED, FATIGUE, IN_OPEN, OUT_OPEN, IN_STOP, OUT_STOP, SPEED_OPEN, YAW, NIGHT, OVERCROWDING FROM (SELECT T.VID, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME, SUM(CASE WHEN T.CODE = '1' THEN 1 ELSE 0 END) AS OVERSPEED, SUM(CASE WHEN T.CODE = '2' THEN 1 ELSE 0 END) AS FATIGUE, SUM(CASE WHEN T.CODE = '60' THEN 1 ELSE 0 END) AS IN_OPEN, SUM(CASE WHEN T.CODE = '61' THEN 1 ELSE 0 END) AS OUT_OPEN, SUM(CASE WHEN T.CODE = '62' THEN 1 ELSE 0 END) AS IN_STOP, SUM(CASE WHEN T.CODE = '63' THEN 1 ELSE 0 END) AS OUT_STOP, SUM(CASE WHEN T.CODE = '64' THEN 1 ELSE 0 END) AS SPEED_OPEN, SUM(CASE WHEN T.CODE = '69' THEN 1 ELSE 0 END) AS YAW, SUM(CASE WHEN T.CODE = '110' THEN 1 ELSE 0 END) AS NIGHT, SUM(CASE WHEN T.CODE = '231' THEN 1 ELSE 0 END) AS OVERCROWDING FROM KCPT.TH_TRACK_ALARM T WHERE T.START_UTC &gt;= ? AND T.START_UTC &lt;= ? GROUP BY T.VID, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME)</property>
        <property name="sql_statisticsOperationsViolationMonth" desc="运营违规月统计">INSERT INTO KCPT.TS_VIOLATION_MONTH M SELECT ? AS STATISTICS_DATE,? AS STATISTICS_YEAR,? AS STATISTICS_MONTH,R.VID,R.PLATE,R.TEAM_ID,R.TEAM_NAME,R.ENT_ID,R.ENT_NAME,R.OVERSPEED,R.FATIGUE,R.AREA_IN_OPEN,R.AREA_OUT_OPEN,R.AREA_IN_STOP,R.AREA_OUT_STOP,R.SPEED_OPEN,R.YAW,R.NIGHT,R.OVERCROWDING FROM (SELECT T.VID,T.PLATE,T.TEAM_ID,T.TEAM_NAME,T.ENT_ID,T.ENT_NAME,SUM(T.OVERSPEED) AS OVERSPEED,SUM(T.FATIGUE) AS FATIGUE,SUM(T.AREA_IN_OPEN) AS AREA_IN_OPEN,SUM(T.AREA_OUT_OPEN) AS AREA_OUT_OPEN,SUM(T.AREA_IN_STOP) AS AREA_IN_STOP,SUM(T.AREA_OUT_STOP) AS AREA_OUT_STOP,SUM(T.SPEED_OPEN) AS SPEED_OPEN,SUM(T.YAW) AS YAW,SUM(T.NIGHT) AS NIGHT,SUM(T.OVERCROWDING) AS OVERCROWDING from TS_VIOLATION_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ? GROUP BY T.VID,T.PLATE,T.TEAM_ID,T.TEAM_NAME,T.ENT_ID,T.ENT_NAME) R</property>
        
        <property name="sql_statisticsOperationsViolationDriverDay" desc="驾驶员运营违规日统计">INSERT INTO TS_VIOLATION_DRIVER_DAY SELECT ? AS STATISTIC_DATE,D.VID,D.DRIVER_ID, E.STAFF_NAME, E.DRIVER_ICCARD, D.PLATE, D.TEAM_ID, D.TEAM_NAME, D.ENT_ID, D.ENT_NAME, D.OVERSPEED, D.FATIGUE, D.IN_OPEN, D.OUT_OPEN, D.IN_STOP, D.OUT_STOP, D.SPEED_OPEN, D.YAW, D.NIGHT, D.OVERCROWDING FROM (SELECT T.VID,T.DRIVER_ID, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME, SUM(CASE WHEN T.CODE = '1' THEN 1 ELSE 0 END) AS OVERSPEED, SUM(CASE WHEN T.CODE = '2' THEN 1 ELSE 0 END) AS FATIGUE, SUM(CASE WHEN T.CODE = '60' THEN 1 ELSE 0 END) AS IN_OPEN, SUM(CASE WHEN T.CODE = '61' THEN 1 ELSE 0 END) AS OUT_OPEN, SUM(CASE WHEN T.CODE = '62' THEN 1 ELSE 0 END) AS IN_STOP, SUM(CASE WHEN T.CODE = '63' THEN 1 ELSE 0 END) AS OUT_STOP, SUM(CASE WHEN T.CODE = '64' THEN 1 ELSE 0 END) AS SPEED_OPEN, SUM(CASE WHEN T.CODE = '69' THEN 1 ELSE 0 END) AS YAW, SUM(CASE WHEN T.CODE = '110' THEN 1 ELSE 0 END) AS NIGHT, SUM(CASE WHEN T.CODE = '231' THEN 1 ELSE 0 END) AS OVERCROWDING FROM KCPT.TH_TRACK_ALARM T WHERE T.DRIVER_ID > 0 AND T.DRIVER_SOURCE !=-1 AND T.START_UTC &gt;= ? AND T.START_UTC &lt;= ? GROUP BY T.VID,T.DRIVER_ID,T.PLATE,T.TEAM_ID,T.TEAM_NAME,T.ENT_ID,T.ENT_NAME) D LEFT JOIN KCPT.TB_EMPLOYEE E ON D.DRIVER_ID=E.STAFF_ID</property>
        <property name="sql_statisticsOperationsViolationDriverMonth" desc="驾驶员运营违规月统计">INSERT INTO KCPT.TS_VIOLATION_DRIVER_MONTH M SELECT ? AS STATISTICS_DATE, ? AS STATISTICS_YEAR, ? AS STATISTICS_MONTH, R.VID, R.DRIVER_ID, R.DRIVER_NAME, R.DRIVER_IC, R.PLATE, R.TEAM_ID, R.TEAM_NAME, R.ENT_ID, R.ENT_NAME, R.OVERSPEED, R.FATIGUE, R.AREA_IN_OPEN, R.AREA_OUT_OPEN, R.AREA_IN_STOP, R.AREA_OUT_STOP, R.SPEED_OPEN, R.YAW, R.NIGHT, R.OVERCROWDING FROM (SELECT T.VID, T.DRIVER_ID, T.DRIVER_NAME, T.DRIVER_IC, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME, SUM(T.OVERSPEED) AS OVERSPEED, SUM(T.FATIGUE) AS FATIGUE, SUM(T.AREA_IN_OPEN) AS AREA_IN_OPEN, SUM(T.AREA_OUT_OPEN) AS AREA_OUT_OPEN, SUM(T.AREA_IN_STOP) AS AREA_IN_STOP, SUM(T.AREA_OUT_STOP) AS AREA_OUT_STOP, SUM(T.SPEED_OPEN) AS SPEED_OPEN, SUM(T.YAW) AS YAW, SUM(T.NIGHT) AS NIGHT, SUM(T.OVERCROWDING) AS OVERCROWDING FROM TS_VIOLATION_DRIVER_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ? GROUP BY T.VID, T.DRIVER_ID, T.DRIVER_NAME, T.DRIVER_IC, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME) R</property>
        
        <property name="sql_initSpeedLimitSettings" desc="初始化限速设置SQL">SELECT TS.VID,NVL(TP.PARAM_VALUE,95) * 10 AS LIMIT FROM KCPT.TR_SERVICEUNIT TS JOIN KCPT.TB_TERMINAL TT ON TS.TID = TT.TID LEFT JOIN KCPT.TB_TERMINAL_PARAM TP ON TP.TID=TS.TID AND TP.PARAM_ID = '128'</property>
		<property name="sql_queryOverspeedSetting" desc="查询平台超速设置">SELECT VID,START_TIME, END_TIME, SPEED_SCALE FROM TB_VEHICLE V JOIN (SELECT A.ENT_ID, B.TB_ID, START_TIME, END_TIME, B.SPEED_SCALE FROM (SELECT CONNECT_BY_ROOT ORG.ENT_ID CFG_ENT_ID, ORG.ENT_ID FROM TB_ORGANIZATION ORG LEFT JOIN (SELECT DISTINCT ENT_ID FROM TB_ALARM_TACTICS_SET WHERE ENABLE_FLAG = '1' AND ALARM_TYPE = '1') TIO ON ORG.ENT_ID = TIO.ENT_ID START WITH ORG.ENT_ID = TIO.ENT_ID CONNECT BY PRIOR ORG.ENT_ID = ORG.PARENT_ID AND NOT EXISTS (SELECT 1 FROM TB_ALARM_TACTICS_SET WHERE ENT_ID = ORG.ENT_ID AND ALARM_TYPE = '1')) A, TB_ALARM_TACTICS_SET B WHERE A.CFG_ENT_ID = B.ENT_ID AND ALARM_TYPE = '1') CFG ON V.ENT_ID = CFG.ENT_ID ORDER BY VID, START_TIME</property>
		<property name="sql_queryFatigueSetting" desc="查询平台疲劳驾驶设置">SELECT VID, START_TIME, END_TIME FROM TB_VEHICLE V JOIN (SELECT A.ENT_ID, B.TB_ID, START_TIME, END_TIME, DEFERRED, B.ISDEFAULT FROM (SELECT CONNECT_BY_ROOT ORG.ENT_ID CFG_ENT_ID, ORG.ENT_ID FROM TB_ORGANIZATION ORG LEFT JOIN (SELECT DISTINCT ENT_ID FROM TB_ALARM_TACTICS_SET WHERE ENABLE_FLAG = '1' AND ALARM_TYPE = '2') TIO ON ORG.ENT_ID = TIO.ENT_ID START WITH ORG.ENT_ID = TIO.ENT_ID CONNECT BY PRIOR ORG.ENT_ID = ORG.PARENT_ID AND NOT EXISTS (SELECT 1 FROM TB_ALARM_TACTICS_SET WHERE ENT_ID = ORG.ENT_ID AND ALARM_TYPE = '2')) A, TB_ALARM_TACTICS_SET B WHERE A.CFG_ENT_ID = B.ENT_ID AND ALARM_TYPE = '2') CFG ON V.ENT_ID = CFG.ENT_ID ORDER BY VID, V.ENT_ID, START_TIME</property>
		<property name="sql_queryNightSetting" desc="查询平台夜间非法运营设置">SELECT VID, START_TIME, END_TIME, DEFERRED FROM TB_VEHICLE V JOIN (SELECT A.ENT_ID, B.TB_ID, START_TIME, END_TIME, DEFERRED, B.ISDEFAULT FROM (SELECT CONNECT_BY_ROOT ORG.ENT_ID CFG_ENT_ID, ORG.ENT_ID FROM TB_ORGANIZATION ORG LEFT JOIN (SELECT DISTINCT ENT_ID FROM TB_ALARM_TACTICS_SET WHERE ENABLE_FLAG = '1' AND ALARM_TYPE = '3') TIO ON ORG.ENT_ID = TIO.ENT_ID START WITH ORG.ENT_ID = TIO.ENT_ID CONNECT BY PRIOR ORG.ENT_ID = ORG.PARENT_ID AND NOT EXISTS (SELECT 1 FROM TB_ALARM_TACTICS_SET WHERE ENT_ID = ORG.ENT_ID AND ALARM_TYPE = '3')) A, TB_ALARM_TACTICS_SET B WHERE A.CFG_ENT_ID = B.ENT_ID AND ALARM_TYPE = '3') CFG ON V.ENT_ID = CFG.ENT_ID ORDER BY VID, V.ENT_ID, START_TIME </property>
	
		<property name="sql_queryDriverOnoffline" desc="查询驾驶员上下线历史记录">SELECT H.VID,E.STAFF_ID,H.ON_LINE_TIME,H.OFF_LINE_TIME FROM (SELECT T.VID, T.ON_LINE_TIME, T.OFF_LINE_TIME, T.QUALIFICATION_NO FROM TH_DRIVER_LOGIN_RECORD T WHERE T.ON_LINE_TIME &gt;= ? AND T.ON_LINE_TIME &lt;= ?) H JOIN KCPT.TB_EMPLOYEE E ON H.QUALIFICATION_NO = E.BUSSINESS_ID ORDER BY H.VID,E.STAFF_ID,H.ON_LINE_TIME</property>
	
		<property name="sql_queryAlarmLevel" desc="查询告警级别设置">SELECT T.ENT_ID ||'_'||T.ALARM_CODE AS TEAM_ID,(T.LEVEL_CODE + 1) AS LEVEL_CODE FROM MVIEW_ALARM_CONF T, KCPT.TB_ORGANIZATION R WHERE T.ENT_ID = R.ENT_ID AND R.ENT_TYPE = 2</property>
		
		<property name="sql_statisticsAlarmLevelDay" desc="告警级别日统计">INSERT INTO TS_ALARM_LEVEL_DAY SELECT ? AS STATISTICS_DATE, ENTID,TOTAL,? FROM (WITH ALARM_COUNT AS (SELECT T.ENT_ID, COUNT(T.ID) AS TOTAL FROM KCPT.TH_TRACK_ALARM T WHERE T.ALARM_LEVEL = ? AND T.START_UTC &gt;= ? AND T.START_UTC &lt;= ? GROUP BY T.ENT_ID), ORG_CNT AS (SELECT A.ENT_ID, A.PARENT_ID, A.ENT_TYPE, C.TOTAL FROM TB_ORGANIZATION A, ALARM_COUNT C WHERE A.ENT_ID = C.ENT_ID(+) AND A.ENABLE_FLAG = '1') SELECT ENT_ID ENTID, SUM(NVL(CONNECT_BY_ROOT(TOTAL), 0)) TOTAL FROM ORG_CNT START WITH ENT_TYPE = 1 CONNECT BY PRIOR PARENT_ID = ENT_ID GROUP BY ENT_ID)</property>
		<property name="sql_statisticsAlarmLevelWeek" desc="告警级别周统计">INSERT INTO TS_ALARM_LEVEL_WEEK SELECT ?,?,?,T.ENT_ID, SUM(T.TOTAL),? FROM TS_ALARM_LEVEL_DAY T WHERE T.ALARM_LEVEL=? AND T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ? GROUP BY T.ENT_ID</property>
		<property name="sql_statisticsAlarmLevelMonth" desc="告警级别月统计">INSERT INTO TS_ALARM_LEVEL_MONTH SELECT ?, ?, ?, T.ENT_ID, SUM(T.TOTAL), ? FROM TS_ALARM_LEVEL_DAY T WHERE T.ALARM_LEVEL = ? AND T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ? GROUP BY T.ENT_ID</property>
		<property name="sql_queryAlarmLevelTotalDay" desc="查询日告警级别总数">SELECT T.ENT_ID,T.TOTAL,T.ALARM_LEVEL FROM TS_ALARM_LEVEL_DAY T WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
		<property name="sql_queryAlarmLevelTotalWeek" desc="查询周告警趋势">SELECT T.ENT_ID,T.TOTAL,T.ALARM_LEVEL from TS_ALARM_LEVEL_WEEK t WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
		<property name="sql_queryAlarmLevelTotalMonth" desc="查询月告警趋势">SELECT T.ENT_ID,T.TOTAL,T.ALARM_LEVEL from TS_ALARM_LEVEL_MONTH t WHERE T.STATISTICS_DATE &gt;= ? AND T.STATISTICS_DATE &lt;= ?</property>
		
		<property name="sql_statisticsAlarmTypeDay" desc="统计日告警类型">INSERT INTO TS_ALARM_TYPE_DAY SELECT ? AS STATISTICS_DATE, VID,PLATE,TEAM_ID,TEAM_NAME,ENT_ID,ENT_NAME, A001,A001D,A002,A002D,A003,A003D,A004,A004D,A005,A005D FROM (SELECT T.VID,T.PLATE,T.TEAM_ID,T.TEAM_NAME,T.ENT_ID,T.ENT_NAME, SUM(CASE WHEN T.PARENT_TYPE='A001' THEN 1 ELSE 0 END) AS A001,SUM(CASE WHEN T.PARENT_TYPE='A001' THEN T.DURATION ELSE 0 END) AS A001D,SUM(CASE WHEN T.PARENT_TYPE='A002' THEN 1 ELSE 0 END) AS A002,SUM(CASE WHEN T.PARENT_TYPE='A002' THEN T.DURATION ELSE 0 END) AS A002D,SUM(CASE WHEN T.PARENT_TYPE='A003' THEN 1 ELSE 0 END) AS A003,SUM(CASE WHEN T.PARENT_TYPE='A003' THEN T.DURATION ELSE 0 END) AS A003D,SUM(CASE WHEN T.PARENT_TYPE='A004' THEN 1 ELSE 0 END) AS A004,SUM(CASE WHEN T.PARENT_TYPE='A004' THEN T.DURATION ELSE 0 END) AS A004D,SUM(CASE WHEN T.PARENT_TYPE='A005' THEN 1 ELSE 0 END) AS A005,SUM(CASE WHEN T.PARENT_TYPE='A005' THEN T.DURATION ELSE 0 END) AS A005D  FROM KCPT.TH_TRACK_ALARM T WHERE T.START_UTC &gt;= ? AND T.START_UTC &lt;= ? GROUP BY T.VID,T.PLATE,T.TEAM_ID,T.TEAM_NAME,T.ENT_ID,T.ENT_NAME)</property>
		<property name="sql_statisticsAlarmTypeMonth" desc="告警类型月统计">INSERT INTO TS_ALARM_TYPE_MONTH SELECT ? AS STATISTICS_DATE, ? AS STATISTICS_YEAR, ? AS STATISTICS_MONTH, VID, PLATE, TEAM_ID, TEAM_NAME, ENT_ID, ENT_NAME, SUM(T.VIOLATION_COUNT), SUM(T.VIOLATION_DURATION), SUM(T.AREA_COUNT), SUM(T.AREA_DURATION), SUM(T.BUS_COUNT), SUM(T.BUS_DURATION), SUM(T.DEVICE_COUNT), SUM(T.DEVICE_DURATION), SUM(T.OTHER_COUNT), SUM(T.OTHER_DURATION) FROM TS_ALARM_TYPE_DAY T WHERE T.STATISTICS_DATE &gt; ? AND T.STATISTICS_DATE &lt;= ? GROUP BY T.VID, T.PLATE, T.TEAM_ID, T.TEAM_NAME, T.ENT_ID, T.ENT_NAME</property>
	
	</config>
	
	<jobs>
		<job name="AlarmStatisticsJob" group="alarm" description="报警统计任务" enable="true">
			<class>com.ctfo.statistics.alarm.job.AlarmStatisticsJob</class>
			<cron desc="调度时间规则">0 5 0 * * ?</cron>
		</job>	
		<job name="AlarmRerunStatisticsJob" group="alarm" description="报警重跑统计任务" enable="${rerun}">
			<class>com.ctfo.statistics.alarm.job.AlarmRerunStatisticsJob</class>
			<cron desc="调度时间规则">0 5 * * * ?</cron>
		</job>	
		<job name="HeartbeatJob" group="alarm" description="测试任务" enable="true">
			<class>com.ctfo.statistics.alarm.job.HeartbeatJob</class>
			<cron desc="调度时间规则">1/30 * * * * ?</cron>
		</job>							 
	</jobs>
	
</configuration>