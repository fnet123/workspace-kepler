<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ArchivesDetail">
  <typeAlias alias="dynamicSqlParameter" type="com.ctfo.local.obj.DynamicSqlParameter" />
  <resultMap class="com.ctfo.archives.beans.ArchivesDetail" id="ArchivesDetail">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Mon Mar 24 16:46:46 CST 2014.
    -->
    <result column="com_name" property="comName" jdbcType="VARCHAR" />
    <result column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="user_code" property="userCode" jdbcType="VARCHAR" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="land_name" property="landName" jdbcType="VARCHAR" />
    <result column="sex" property="sex" jdbcType="VARCHAR" />
    <result column="nation" property="nation" jdbcType="VARCHAR" />
    <result column="birthday" property="birthday" jdbcType="BIGINT" />
    <result column="idcard_num" property="idcardNum" jdbcType="VARCHAR" />
    <result column="register_address" property="registerAddress" jdbcType="VARCHAR" />
    <result column="native_place" property="nativePlace" jdbcType="VARCHAR" />
    <result column="political_status" property="politicalStatus" jdbcType="VARCHAR" />
    <result column="user_phone" property="userPhone" jdbcType="VARCHAR" />
    <result column="user_telephone" property="userTelephone" jdbcType="VARCHAR" />
    <result column="user_fax" property="userFax" jdbcType="VARCHAR" />
    <result column="user_email" property="userEmail" jdbcType="VARCHAR" />
    <result column="user_address" property="userAddress" jdbcType="VARCHAR" />
    <result column="user_height" property="userHeight" jdbcType="VARCHAR" />
    <result column="user_weight" property="userWeight" jdbcType="VARCHAR" />
    <result column="entry_date" property="entryDate" jdbcType="BIGINT" />
    <result column="position" property="position" jdbcType="VARCHAR" />
    <result column="level" property="level" jdbcType="VARCHAR" />
    <result column="graduate_institutions" property="graduateInstitutions" jdbcType="VARCHAR" />
    <result column="specialty" property="specialty" jdbcType="VARCHAR" />
    <result column="education" property="education" jdbcType="VARCHAR" />
    <result column="graduate_date" property="graduateDate" jdbcType="BIGINT" />
    <result column="technical_expertise" property="technicalExpertise" jdbcType="VARCHAR" />
    <result column="wage" property="wage" jdbcType="VARCHAR" />
    <result column="is_operator" property="isOperator" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="data_sources" property="dataSources" jdbcType="VARCHAR" />
    <result column="create_by" property="createBy" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="BIGINT" />
    <result column="update_by" property="updateBy" jdbcType="VARCHAR" />
    <result column="update_time" property="updateTime" jdbcType="BIGINT" />
    <result column="org_name" property="orgName" jdbcType="VARCHAR" />
    <result column="health" property="health" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap class="com.ctfo.archives.beans.ArchivesDetail" id="ArchivesDetailList">
   <result column="user_id" property="userId" jdbcType="VARCHAR" />
   <result column="user_code" property="userCode" jdbcType="VARCHAR" />
   <result column="land_name" property="landName" jdbcType="VARCHAR" />
   <result column="user_name" property="userName" jdbcType="VARCHAR" />
   <result column="role_name" property="roleName" jdbcType="VARCHAR" />
   <result column="com_name" property="comName" jdbcType="VARCHAR" />
   <result column="org_name" property="orgName" jdbcType="VARCHAR" />
   <result column="setbook_name" property="setbookName" jdbcType="VARCHAR" />
   <result column="is_operator" property="isOperator" jdbcType="VARCHAR" />
   <result column="create_time" property="createTime" jdbcType="BIGINT" />
   <result column="login_time" property="loginTime" jdbcType="BIGINT" />   
  </resultMap>
 
   <sql id="where">
    WHERE 1=1
  </sql> 
  <sql id="where_param">
    <include refid="where" />
    <include refid="equal_WHERE" />
    <include refid="like_WHERE" />
  </sql>
  <sql id="like_WHERE">
  <isNotNull prepend="AND" property="like.comName">
      bo.COM_NAME like CONCAT('%',#like.comName:VARCHAR#,'%')
  </isNotNull>
  <isNotNull prepend="AND" property="like.setbookName">
      bo.setbook_name like CONCAT('%',#like.setbookName:VARCHAR#,'%')
  </isNotNull>
  <isNotNull prepend="AND" property="like.clientAccount">
      us.land_name like CONCAT('%',#like.clientAccount:VARCHAR#,'%')
  </isNotNull>  
  </sql> 
  <sql id="equal_WHERE">
  <isNotNull prepend="AND" property="equal.registTimeStart">
      <![CDATA[(#equal.registTimeStart:VARCHAR# <= us.create_time )]]>
  </isNotNull>
  <isNotNull prepend="AND" property="equal.registEndTimeEnd">
      <![CDATA[(#equal.registEndTimeEnd:VARCHAR# >= us.create_time )]]>
  </isNotNull>  
  <isNotNull prepend="AND" property="equal.landTimeStart">
      <![CDATA[(#equal.landTimeStart:VARCHAR# <= lo.login_time )]]>
  </isNotNull>
  <isNotNull prepend="AND" property="equal.landEndTimeEnd">
      <![CDATA[(#equal.registEndTimeEnd:VARCHAR# >= lo.login_time )]]>
  </isNotNull>
  <isNotNull prepend="AND" property="equal.comId">
      bo.id = #equal.comId:VARCHAR#
  </isNotNull>  
  </sql>
 
  
<select id="selectPk" parameterClass="string" resultMap="ArchivesDetail">
	SELECT 
	us.user_id,
	us.user_code,
	us.user_phone,
	com.com_name,
	us.user_name,
	us.user_telephone,
	org.org_name,
	us.sex,
	us.user_fax,
	us.is_operator,
	us.political_status,
	us.user_email,
	us.land_name,
	us.idcard_num,
	us.user_address,
	us.remark,
	us.create_by,
	us.create_time,
	us.status,
	us.update_by,
	us.update_time,
	us.data_sources,
	us.nation,
	us.graduate_institutions,
	us.technical_expertise,
	us.user_height,
	us.native_place,
	us.specialty,
	us.entry_date,
	us.user_weight,
	us.register_address,
	us.graduate_date,
	us.wage,
	us.birthday,
	us.education,
	us.position,
	us.health,
	us.political_status,
	us.level
	FROM 
	sys_user us 
	LEFT JOIN 
	tr_user_role rl ON 
	us.user_id = rl.user_id
	LEFT JOIN tb_company com ON
	us.ser_station_id = com.com_id
	LEFT JOIN tb_organization org ON
	us.org_id = org.org_id
	where us.user_id = #tbUserOnlineId:VARCHAR#
</select>
  
 <select id="countParam" parameterClass="dynamicSqlParameter" resultClass="int">
  SELECT COUNT(1) FROM  
  (SELECT 
	  us.user_id,
	  us.user_code,
	  us.land_name,
	  us.user_name,
	  ro.role_name,
	  bo.com_name,
	  org.org_name,
	  bo.setbook_name,
	  us.is_operator,
	  us.create_time,
	  MAX(lo.login_time) as login_time
	FROM
	  sys_user us 
	  LEFT JOIN tr_user_role rl 
	    ON us.user_id = rl.user_id 
	  LEFT JOIN sys_role ro 
	    ON rl.role_id = ro.role_id 
	  LEFT JOIN tb_organization org 
	    ON us.org_id = org.org_id 
	  LEFT JOIN sys_setbook bo 
	    ON us.set_book_id = bo.set_book_id 
	  LEFT JOIN sys_log_log lo 
	    ON us.user_id = lo.user_id 
	<include refid="where_param" />
	GROUP BY us.user_id
	) BB
 </select>
 <select id="selectPageForParam" parameterClass="dynamicSqlParameter" resultMap="ArchivesDetailList">
  SELECT BB.* FROM 
   (SELECT 
	  us.user_id,
	  us.user_code,
	  us.land_name,
	  us.user_name,
	  ro.role_name,
	  bo.com_name,
	  org.org_name,
	  bo.setbook_name,
	  us.is_operator,
	  us.create_time,
	  MAX(lo.login_time) as login_time
	FROM
	  sys_user us 
	  LEFT JOIN tr_user_role rl 
	    ON us.user_id = rl.user_id 
	  LEFT JOIN sys_role ro 
	    ON rl.role_id = ro.role_id 
	  LEFT JOIN tb_organization org 
	    ON us.org_id = org.org_id 
	  LEFT JOIN sys_setbook bo 
	    ON us.set_book_id = bo.set_book_id 
	  LEFT JOIN sys_log_log lo 
	    ON us.user_id = lo.user_id 
	<include refid="where_param" />
	GROUP BY us.user_id
	order by us.create_time desc
	) BB
	LIMIT #startNum#,#pagesize#
 </select>
</sqlMap>