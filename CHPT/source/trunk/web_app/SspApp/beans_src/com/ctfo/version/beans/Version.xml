<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Version">
  <typeAlias alias="map" type="java.util.Map"/>
  <resultMap class="com.ctfo.version.beans.Version" id="Version">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Mon Mar 24 16:46:46 CST 2014.
    -->
    <result column="id" property="id" jdbcType="VARCHAR" />
    <result column="version" property="version" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="version_type" property="versionType" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="BIGINT" />
  </resultMap>
  <sql id="columns">
	id, version, address, version_type, create_time
  </sql>
  <sql id="table">
    tb_ssp_version
  </sql>

  <select id="select" parameterClass="map" resultMap="Version">
	SELECT 
	    <include refid="columns" /> 
	     FROM 
	    <include refid="table" />
	    where version_type =  #version_type:VARCHAR#
    order by create_time desc  limit 1
  </select>
  
  <select id="selectVersionDb" parameterClass="map" resultClass="java.lang.String">
	  <![CDATA[ 	SELECT r.version_db
		FROM tb_ssp_version r
		WHERE r.version_type = '1'
		AND (
			SELECT n.create_time FROM tb_ssp_version n
		 	WHERE n.version_db = #currDbVersion:VARCHAR# and n.version_type='1'
		)  < r.create_time and r.create_time <= (
			SELECT v.create_time FROM tb_ssp_version v
			WHERE v.version = #currSoftVersion:VARCHAR# AND v.version_type = '1'
		) ]]>  
  </select>
  
</sqlMap>